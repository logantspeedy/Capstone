<!DOCTYPE html>
<html>
	<head>
		<title>Winter is coming!</title>
        <script src="https://apis.google.com/js/client:plusone.js"></script>
        <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
		<style>
			@import url(http://fonts.googleapis.com/css?family=Shadows+Into+Light);

			* {
				margin: 0px 0px;
				padding: 0px 0px;
			}

			body {
				color: #AA3939;
				background-color: #550000;
				min-width: 60em;
			}

			section {
				padding: 50px;
			}

			h1 {
				font-size: 8em;
				font-family: 'Shadows Into Light', cursive;
			}

			header h1, footer p {
				text-align: center;
			}

			#g-signin {
				display: block;
				margin-left: auto;
				margin-right: auto;
			}

		</style>
	</head>
	<body>
		<header>
			<h1>Winter is coming!</h1>
		</header>
		<section>
            <div id="gConnect">
                <button class="g-signin"
                        data-scope="https://www.googleapis.com/auth/plus.login"
                        data-requestvisibleactions="http://schemas.google.com/AddActivity"
                        data-clientId="110076700425-pvvvqklvu9tdef18geepbn5vplv2tcpr.apps.googleusercontent.com"
                        data-accesstype="offline"
                        data-callback="onSignInCallback"
                        data-cookiepolicy="single_host_origin"
                        data-width="wide">
                </button>
            </div>
		</section>
		<footer>
			<p>Copyright 2014</p>
		</footer>
        <script>

            var requestToken = function() {
                var state;
                return function( callback ) {

                    if ( state !== undefined ) {
                        callback( state );
                        return
                    }

                    $.ajax({
                        dataType: 'json',
                        url: 'state.json',
                        success: function( data ) {
                            state = data.state;
                            callback( state );
                        }
                    });
                };
            }();

            var onSignInCallback = function( authResult ) {

                if ( authResult['code'] ) {

                    $( '#gConnect' ).hide();
                    requestToken( function( state ) {
                        $.ajax({
                            type: 'POST',
                            url: 'connect?state=' + state,
                            contentType: 'application/octet-stream; charset=utf-8',
                            success: function( result ) {
                                location.href = "game.html";
                            },
                            processData: false,
                            data: authResult['code']
                        });
                    });
                };
            };
        </script>
    </body>
</html>
